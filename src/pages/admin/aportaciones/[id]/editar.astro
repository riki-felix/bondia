---
export const prerender = false;

import Admin from "../../../../components/Admin.astro";
import AportacionForm from "../../../../components/AportacionForm.astro";
import { supabaseClient } from "../../../../lib/supabaseClient";

const { id } = Astro.params;
const supabase = supabaseClient();

const { data: aportacion, error } = await supabase
  .from("aportaciones")
  .select("*")
  .eq("id", id)
  .single();

const { data: propiedades } = await supabase
  .from("propiedades")
  .select("id, titulo")
  .order("titulo");
---

<Admin>
  {error && <p>❌ Error cargando aportación</p>}

  {aportacion && (
	<>
	  <nav>
		<a href="/admin/aportaciones">← Volver al listado</a>
	  </nav>
	  <AportacionForm mode="edit" initial={aportacion} propiedades={propiedades ?? []} />
	</>
  )}
</Admin>