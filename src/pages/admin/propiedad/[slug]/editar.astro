---
export const prerender = false;

import Admin from "../../../../components/Admin.astro";
import PropertyForm from "../../../../components/PropertyForm.astro";
import { supabaseClient } from "../../../../lib/supabaseClient";

const { slug } = Astro.params;

if (!slug) {
  throw new Error("Falta el parámetro slug en la URL.");
}

const supabase = supabaseClient();

// Cargar la propiedad por slug
const { data: property, error } = await supabase
  .from("propiedades")
  .select("*")
  .eq("slug", slug)
  .maybeSingle();
---

<Admin title="Editar propiedad">
  {error && (
	<p style="color:red">
	  Error cargando propiedad: {error.message}
	</p>
  )}

  {!error && !property && (
	<>
	  <p>No se ha encontrado ninguna propiedad con slug: <strong>{slug}</strong></p>
	  <p><a href="/admin/propiedades">← Volver al listado</a></p>
	</>
  )}

  {property && (
	<>
	  <nav style="display:flex; gap:12px; align-items:center; margin-bottom:14px;">
		<a href="/admin/propiedades">← Volver al listado</a>
		<span style="opacity:.5">|</span>
		<a href={`/propiedad/${property.slug}`}>Ver propiedad</a>
	  </nav>

	  <PropertyForm mode="edit" initial={property} />
	</>
  )}
</Admin>