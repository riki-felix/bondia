---
/*
  RdsTotalsWidget
  Props:
	- resumen: {
		totalGastos: number;
		totalIngresos: number;
		totalPromos: number;
	  }
	- size?: number | string
*/

import WidgetShell from "../WidgetShell.astro";
import { toNum, formatEuro } from "../../lib/money";

interface RdsResumenGlobal {
  totalGastos: number;
  totalIngresos: number;
  totalPromos: number;
}

interface Props {
  resumen: RdsResumenGlobal;
  size?: number | string;
}

const { resumen, size = 7 } = Astro.props as Props;

// Normalizamos a número con el parser global
const totalGastos = toNum(resumen?.totalGastos ?? 0);
const totalIngresos = toNum(resumen?.totalIngresos ?? 0);
const totalPromos = toNum(resumen?.totalPromos ?? 0);

// Beneficios
const beneficio = totalIngresos - totalGastos;
const beneficioPart = beneficio / 2;

const beneficioAjustado = beneficio - totalPromos;
const beneficioRealPart = beneficioAjustado / 4;

// Formateador común de dinero
const fmt = (value: number) => formatEuro(value);
---

<WidgetShell size={size} ariaLabelledBy="wg-rds-totals-title">
  <div class="widget-row--totals">
	<div class="widget-cell">
	  <span class="data-money data-xl">{fmt(beneficioAjustado)}</span>
	  <span id="wg-rds-totals-title" class="data-label label-m">
		Beneficio Real
	  </span>
	  <span class="data-label label-s">
		Mi parte <span class="data-money data-s">{fmt(beneficioRealPart)}</span>
	  </span>
	</div>
  </div>

  <div class="widget-row wg--4col">
	<div class="widget-cell">
	  <span class="data-money data-m">{fmt(beneficio)}</span>
	  <span class="data-label label-s">
		Beneficio
	  </span>
	</div>
	<div class="widget-cell">
	  <span class="data-money data-m">{fmt(totalIngresos)}</span>
	  <span class="data-label label-s">Ingresos</span>
	</div>
	<div class="widget-cell">
	  <span class="data-money data-m">{fmt(totalGastos)}</span>
	  <span class="data-label label-s">Gastos</span>
	</div>
	<div class="widget-cell">
	  <span class="data-money data-m">{fmt(totalPromos * -1)}</span>
	  <span class="data-label label-s">Promoción</span>
	</div>
  </div>
</WidgetShell>