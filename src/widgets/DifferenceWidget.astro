---
import WidgetShell from "./WidgetShell.astro";
import { formatEuro, toNum } from "../lib/money";

interface Totals {
  total: number | null;
}

interface Props {
  precio_venta?: number | string | null;
  totals: Totals;
  size?: number | string;
}

const {
  precio_venta,
  totals,
  size = 4,
} = Astro.props as Props;

// Normalizamos valores num√©ricos con helper global
const pv = toNum(precio_venta);
const gastos = toNum(totals?.total);

// Margen
const margen = pv - gastos;

// JAPS: 20% del margen
const comision = margen * 0.20;

// CBH / Sanyus: 40% cada uno
const mitad = margen * 0.40;
---

<WidgetShell size={size} ariaLabelledBy="wg-margen-title">
  <div class="widget-row--totals">
	<div class="widget-cell">
	  <span id="wg-margen-title" class="data-label label-m">
		Margen
	  </span>

	  <span class="data-money data-xl">
		{formatEuro(margen)}
	  </span>

	  <span class="data-label label-xs">
		Vendido por {formatEuro(pv)}
	  </span>
	</div>
  </div>

  <div class="widget-row wg--3col">
	<div class="widget-cell">
	  <span class="data-money data-m">{formatEuro(comision)}</span>
	  <span class="data-label label-s">JAPS</span>
	</div>

	<div class="widget-cell">
	  <span class="data-money data-m">{formatEuro(mitad)}</span>
	  <span class="data-label label-s">CBH</span>
	</div>

	<div class="widget-cell">
	  <span class="data-money data-m">{formatEuro(mitad)}</span>
	  <span class="data-label label-s">Sanyus</span>
	</div>
  </div>
</WidgetShell>