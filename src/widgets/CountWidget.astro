---
/*
  CountWidget
  Props:
	- propiedades: array de propiedades
	- tipo?: string
	- estado?: string
	- label?: string
	- size?: number | string   // NUEVO: controla grid-X via WidgetShell
*/
import WidgetShell from "./WidgetShell.astro";
import { normalize } from "../lib/text";

interface Props {
  propiedades: any[];
  tipo?: string;
  estado?: string;
  label?: string;
  size?: number | string;
}

const {
  propiedades = [],
  tipo = "",
  estado = "",
  label = "",
  size = 2,
} = Astro.props as Props;

const norm = (s: string) => normalize(s);

const filtered = propiedades.filter((p: any) => {
  if (tipo && norm(p.tipo ?? "") !== norm(tipo)) return false;
  if (estado && norm(p.estado ?? "") !== norm(estado)) return false;
  return true;
});

const count = filtered.length;

const displayLabel =
  label ||
  (tipo && estado
	? `Total ${tipo} (${estado})`
	: tipo
	? `Total ${tipo}`
	: estado
	? `Total con estado "${estado}"`
	: "Total");
---

<WidgetShell size={size} ariaLabelledBy="wg-count-title">
  <div class="widget-row--totals">
	<div class="widget-cell">
	  <span id="wg-count-title" class="data-label label-m">
		{displayLabel}
	  </span>
	  <span class="data-money data-xl">{count}</span>
	  <span class="data-label label-xs"></span>
	</div>
  </div>
</WidgetShell>